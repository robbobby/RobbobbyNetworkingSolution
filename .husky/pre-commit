#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit checks..."

echo "ğŸ“ Formatting C# files..."
# Safe whitespace across the whole repo (tests included, no analyzer code fixes):
#dotnet format whitespace --no-restore --verbosity minimal || echo "âš ï¸  Formatting failed - continuing anyway"

# Analyzer fixes only for non-test projects:
#for p in Serializer.Abstractions Serializer.Generator Serializer.Runtime Serializer.Wire Transport.Client Transport.Server Unity.Package; do
#  dotnet format analyzers "$p" --no-restore --verbosity minimal || echo "âš ï¸  Analyzer formatting for $p failed - continuing anyway"
#done

# Ensure formatting changes are included in this commit
echo "ğŸ“¦ Staging formatting changes..."
git add -u

echo "ğŸ”¨ Building solution..."
dotnet build || echo "âš ï¸  Build failed - continuing anyway"

# Run unit tests
echo "ğŸ§ª Running unit tests..."
dotnet test --filter "Category=Unit" --verbosity minimal || echo "âš ï¸  Unit tests failed - continuing anyway"

echo "âœ… Pre-commit checks completed - proceeding with commit"
