#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸš€ Running pre-push validation..."

echo "ğŸ”— Running integration tests..."
if out="$(dotnet test --filter "Category=Integration" --verbosity minimal 2>&1)"; then
    echo "$out"
    echo "âœ… Integration tests completed successfully!"
else
    echo "$out"
    if printf '%s' "$out" | grep -qiE 'No test is available'; then
        echo "âš ï¸  No integration tests found - continuing with validation"
    else
        echo "âš ï¸  Integration tests failed - continuing (pre-push is non-blocking)"
    fi
fi

echo "âš¡ Running performance benchmarks..."
if out="$(cd Benchmarks.Tests && dotnet test --configuration Release --filter "Category=Benchmark" --verbosity minimal 2>&1)"; then
    echo "$out"
    echo "âœ… Benchmark tests completed successfully!"
else
    echo "$out"
    if printf '%s' "$out" | grep -qiE 'No test is available'; then
        echo "âš ï¸  No benchmark tests found - continuing with validation"
    else
        echo "âš ï¸  Benchmark tests failed - continuing (pre-push is non-blocking)"
    fi
fi

echo "ğŸ”¨ Building solution in Release mode..."
dotnet build --configuration Release

echo "ğŸ“¦ Validating package builds..."
dotnet pack --configuration Release --no-build

echo "âœ… Pre-push validation completed successfully!"
