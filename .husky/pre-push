#!/usr/bin/env bash
. "$(dirname -- "$0")/_/husky.sh"

echo "🚀 Running pre-push validation..."

echo "🔗 Running integration tests..."
if ! dotnet test --filter "Category=Integration" --verbosity minimal; then
    echo "⚠️  Integration tests failed"
    printf "Continue with push anyway? (y/n): "
    read -r REPLY < /dev/tty
    if [[ ! "$REPLY" =~ ^[Yy]$ ]]; then
        echo "❌ Push aborted"
        exit 1
    fi
fi

echo "🔨 Building solution in Release mode..."
if ! dotnet build --configuration Release; then
    echo "⚠️  Release build failed"
    printf "Continue with push anyway? (y/n): "
    read -r REPLY < /dev/tty
    if [[ ! "$REPLY" =~ ^[Yy]$ ]]; then
        echo "❌ Push aborted"
        exit 1
    fi
fi

echo "📦 Validating package builds..."
if ! dotnet pack --configuration Release --no-build; then
    echo "⚠️  Package build failed"
    printf "Continue with push anyway? (y/n): "
    read -r REPLY < /dev/tty
    if [[ ! "$REPLY" =~ ^[Yy]$ ]]; then
        echo "❌ Push aborted"
        exit 1
    fi
fi

echo "✅ Pre-push validation completed - proceeding with push"
