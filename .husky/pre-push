#!/usr/bin/env bash
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸš€ Running pre-push validation..."

echo "ğŸ”— Running integration tests..."
if ! dotnet test --filter "Category=Integration" --verbosity minimal; then
    echo "âš ï¸  Integration tests failed"
    printf "Continue with push anyway? (y/n): "
    read -r REPLY < /dev/tty
    if [[ ! "$REPLY" =~ ^[Yy]$ ]]; then
        echo "âŒ Push aborted"
        exit 1
    fi
fi

echo "ğŸ”¨ Building solution in Release mode..."
if ! dotnet build --configuration Release; then
    echo "âš ï¸  Release build failed"
    printf "Continue with push anyway? (y/n): "
    read -r REPLY < /dev/tty
    if [[ ! "$REPLY" =~ ^[Yy]$ ]]; then
        echo "âŒ Push aborted"
        exit 1
    fi
fi

echo "ğŸ“¦ Validating package builds..."
if ! dotnet pack --configuration Release --no-build; then
    echo "âš ï¸  Package build failed"
    printf "Continue with push anyway? (y/n): "
    read -r REPLY < /dev/tty
    if [[ ! "$REPLY" =~ ^[Yy]$ ]]; then
        echo "âŒ Push aborted"
        exit 1
    fi
fi

echo "âœ… Pre-push validation completed - proceeding with push"
